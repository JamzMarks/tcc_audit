generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public"]
}

model User {
  id         String      @id
  email      String      @unique
  firstName  String
  lastName   String
  password   String
  role       Roles       @default(USER)
  isActive   Boolean     @default(true)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime
  avatar     String?
  UserConfig UserConfig?

  @@schema("public")
}

model UserConfig {
  id       String   @id
  userId   String   @unique
  language Language @default(EN)
  theme    Theme    @default(LIGHT)
  User     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@schema("public")
}



enum Language {
  PTBR
  EN
  ES

  @@schema("public")
}

enum Roles {
  USER
  ADMIN
  ENGINEER
  AUDITOR

  @@schema("public")
}

enum Theme {
  LIGHT
  DARK

  @@schema("public")
}

model MetricLog {
  id           Int       @id @default(autoincrement())
  
  // Origem
  queue        String
  routingKey   String?

  // Informações do tipo da mensagem
  eventType    String?    // ex: "analysis", "sensor", "telemetry"
  category     String?    // ex: "pipeline", "error", "device"
  source       String?    // ex: deviceId, serviceName, microserviço de origem

  // Dados brutos
  payload      Json

  // Auxiliares
  receivedAt   DateTime   @default(now())  // quando o consumer processou
  timestamp    DateTime?                 // timestamp vindo do payload (se tiver)

  // Indexação
  @@index([queue])
  @@index([routingKey])
  @@index([eventType])
  @@index([category])
  @@index([source])
  @@index([timestamp])
  
  @@schema("public")
}

